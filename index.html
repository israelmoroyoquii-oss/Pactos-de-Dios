<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Los Pactos De Dios</title>
    <!-- Carga de Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Configuraci√≥n para usar la fuente Inter -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d111c; /* Fondo oscuro */
        }
        /* Estilo para las tarjetas */
        .covenant-card {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.15);
            transition: transform 0.3s ease;
        }
        .covenant-card:hover {
            transform: translateY(-5px);
        }
    </style>
</head>
<body class="min-h-screen text-white">

    <header class="py-10 px-4 sm:px-6 lg:px-8 bg-[#1e293b]">
        <div class="max-w-4xl mx-auto text-center">
            <h1 class="text-3xl sm:text-4xl font-extrabold text-[#38bdf8]">
                Los Pactos De Dios
            </h1>
            <p class="mt-2 text-lg text-gray-300">
                El Plan Imparable de Dios en 5 Estaciones.
            </p>
        </div>
    </header>

    <main class="py-12 px-4 sm:px-6 lg:px-8">
        <div class="max-w-4xl mx-auto grid grid-cols-1 md:col-span-2 lg:grid-cols-3 gap-8">

            <!-- Pacto 1: NO√â -->
            <div class="covenant-card bg-[#1a2333] p-6 rounded-xl border-t-4 border-t-green-400">
                <span class="text-4xl font-black text-green-400 block mb-3">#1</span>
                <h2 class="text-2xl font-bold mb-2">PACTO NO√â (Universal)</h2>
                <p class="text-sm italic text-gray-400 mb-4">La Promesa de No-Destrucci√≥n. Un pacto UNILATERAL.</p>
                <div class="space-y-3">
                    <p class="text-sm font-semibold text-gray-200">Enfoque: Dios restablece la relaci√≥n con la creaci√≥n.</p>
                    <p class="text-xs p-2 bg-[#2c3749] rounded-lg border border-gray-600">
                        <strong class="text-green-400">G√©nesis 9:11, 13:</strong> "Establecer√© mi pacto con vosotros, y no ser√° exterminada ya m√°s toda carne con aguas de diluvio..."
                    </p>
                    <p class="text-sm font-bold text-green-400 pt-1">
                        LECCI√ìN: DIOS ES FIEL SIEMPRE. Su plan no se detuvo por el diluvio.
                    </p>
                </div>
            </div>

            <!-- Pacto 2: ABRAHAM -->
            <div class="covenant-card bg-[#1a2333] p-6 rounded-xl border-t-4 border-t-blue-400">
                <span class="text-4xl font-black text-blue-400 block mb-3">#2</span>
                <h2 class="text-2xl font-bold mb-2">PACTO ABRAHAM (Naci√≥n)</h2>
                <p class="text-sm italic text-gray-400 mb-4">La Promesa de la Familia de la Fe.</p>
                <div class="space-y-3">
                    <p class="text-sm font-semibold text-gray-200">Enfoque: De una naci√≥n, todas las familias de la tierra ser√°n benditas (El spoiler de Jes√∫s).</p>
                    <p class="text-xs p-2 bg-[#2c3749] rounded-lg border border-gray-600">
                        <strong class="text-blue-400">G√©nesis 12:2-3:</strong> "...ser√°n benditas en ti todas las familias de la tierra."
                    </p>
                    <p class="text-sm font-bold text-blue-400 pt-1">
                        LECCI√ìN: DIOS TIENE UN PROP√ìSITO GLOBAL. Eres parte de la bendici√≥n prometida.
                    </p>
                </div>
            </div>

            <!-- Pacto 3: LEY (Antes MOSAICO) -->
            <div class="covenant-card bg-[#1a2333] p-6 rounded-xl border-t-4 border-t-red-500">
                <span class="text-4xl font-black text-red-500 block mb-3">#3</span>
                <h2 class="text-2xl font-bold mb-2">PACTO LEY (Las Reglas)</h2>
                <p class="text-sm italic text-gray-400 mb-4">El Contrato de la Ley y las Reglas. CONDICIONAL.</p>
                <div class="space-y-3">
                    <p class="text-sm font-semibold text-gray-200">Enfoque: Demostr√≥ que el hombre no puede cumplirlo. Nos muestra el pecado.</p>
                    <p class="text-xs p-2 bg-[#2c3749] rounded-lg border border-gray-600">
                        <strong class="text-red-500">G√°latas 3:24 (RV60):</strong> "...la ley ha sido nuestro **ayo**, para llevarnos a Cristo..."
                    </p>
                    <p class="text-sm font-bold text-red-500 pt-1">
                        LECCI√ìN: LA LEY ES BUENA, PERO NO SALVA. Muestra nuestra incapacidad y nos lleva a Cristo.
                    </p>
                </div>
            </div>

            <!-- Pacto 4: DAVID -->
            <div class="covenant-card bg-[#1a2333] p-6 rounded-xl border-t-4 border-t-purple-400">
                <span class="text-4xl font-black text-purple-400 block mb-3">#4</span>
                <h2 class="text-2xl font-bold mb-2">PACTO DAVID (Reino)</h2>
                <p class="text-sm italic text-gray-400 mb-4">La Promesa del Trono Eterno.</p>
                <div class="space-y-3">
                    <p class="text-sm font-semibold text-gray-200">Enfoque: De la descendencia de David saldr√° un Rey cuyo trono ser√° eterno.</p>
                    <p class="text-xs p-2 bg-[#2c3749] rounded-lg border border-gray-600">
                        <strong class="text-purple-400">2 Samuel 7:12-13:</strong> "Y yo afirmar√© para siempre el trono de su reino."
                    </p>
                    <p class="text-sm font-bold text-purple-400 pt-1">
                        LECCI√ìN: JES√öS ES EL JEFE ETERNO. El plan termina con un Rey, y ese Rey es Jes√∫s.
                    </p>
                </div>
            </div>

            <!-- Pacto 5: NUEVO PACTO -->
            <div class="covenant-card bg-[#1a2333] p-6 rounded-xl border-t-4 border-t-yellow-400 md:col-span-2 lg:col-span-1 mx-auto w-full max-w-sm lg:max-w-none">
                <span class="text-4xl font-black text-yellow-400 block mb-3">#5</span>
                <h2 class="text-2xl font-bold mb-2">EL NUEVO PACTO (Gracia)</h2>
                <p class="text-sm italic text-gray-400 mb-4">El Contrato Definitivo: La Sangre de Jes√∫s.</p>
                <div class="space-y-3">
                    <p class="text-sm font-semibold text-gray-200">Enfoque: Ley escrita en el coraz√≥n, perd√≥n completo y acceso directo a Dios.</p>
                    <p class="text-xs p-2 bg-[#2c3749] rounded-lg border border-gray-600">
                        <strong class="text-yellow-400">Lucas 22:20 (Cumplimiento):</strong> "Esta copa es el nuevo pacto en mi sangre..."
                    </p>
                    <p class="text-sm font-bold text-yellow-400 pt-1">
                        LECCI√ìN: EL REGALO M√ÅS PRO! No es por lo que haces (Ley), sino por lo que **√âl ya hizo** (Sangre).
                    </p>
                </div>
            </div>

            <!-- Cierre de la secci√≥n -->
            <div class="md:col-span-2 lg:col-span-3 text-center pt-8">
                <p class="text-xl font-semibold text-[#38bdf8]">
                    El Nuevo Pacto es la meta. Es tu nueva realidad.
                </p>
            </div>

        </div>

        <!-- M√≥dulo Gemini API: Pregunta al T√≠o Pactos -->
        <div class="max-w-4xl mx-auto mt-16 p-8 bg-[#1e293b] rounded-xl shadow-2xl border-2 border-[#38bdf8]">
            <h2 class="text-2xl font-extrabold text-center text-white mb-6">
                Preg√∫ntale al T√≠o Pactos ü§ì
            </h2>
            <p class="text-gray-300 text-center mb-6">
                Selecciona un Pacto y pregunta c√≥mo aplicarlo a un problema real de tu vida (amistad, estudios, etc.).
            </p>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6">
                <!-- Selector de Pacto -->
                <div>
                    <label for="pacto-select" class="block text-sm font-medium text-gray-300 mb-1">Pacto a Consultar:</label>
                    <select id="pacto-select" class="w-full p-3 bg-[#2c3749] text-white rounded-lg border border-gray-600 focus:ring-[#38bdf8] focus:border-[#38bdf8]">
                        <option value="PACTO NO√â">1. PACTO NO√â (Fidelidad de Dios)</option>
                        <option value="PACTO ABRAHAM">2. PACTO ABRAHAM (Prop√≥sito Global)</option>
                        <!-- Titulo actualizado de Mosaico a Ley -->
                        <option value="PACTO LEY (Las Reglas)">3. PACTO LEY (La Ley como Espejo)</option>
                        <option value="PACTO DAVID">4. PACTO DAVID (Jes√∫s es Rey)</option>
                        <option value="EL NUEVO PACTO" selected>5. EL NUEVO PACTO (Gracia y Perd√≥n)</option>
                    </select>
                </div>

                <!-- Campo de Pregunta -->
                <div>
                    <label for="pregunta-input" class="block text-sm font-medium text-gray-300 mb-1">Tu Pregunta/Problema:</label>
                    <input type="text" id="pregunta-input" placeholder="Ej: ¬øC√≥mo perdono a un amigo que me fall√≥?" class="w-full p-3 bg-[#2c3749] text-white rounded-lg border border-gray-600 focus:ring-[#38bdf8] focus:border-[#38bdf8]" maxlength="100">
                </div>
            </div>

            <button id="generar-btn" class="w-full py-3 bg-yellow-500 text-gray-900 font-bold rounded-lg hover:bg-yellow-400 transition duration-200 flex items-center justify-center">
                <svg id="loader" class="animate-spin -ml-1 mr-3 h-5 w-5 text-gray-900 hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <span id="button-text">Generar Consejo ‚ú®</span>
            </button>

            <!-- √Årea de Resultado -->
            <div id="resultado-div" class="mt-8 p-4 bg-[#2c3749] rounded-xl border-l-4 border-l-yellow-500 hidden">
                <p class="text-sm font-semibold text-yellow-500 mb-2">Respuesta del T√≠o Pactos:</p>
                <p id="aplicacion-text" class="text-gray-100 italic"></p>
            </div>
        </div>

    </main>

    <footer class="text-center py-6 bg-[#1a2333] mt-10">
        <p class="text-sm text-gray-400">
            Material de apoyo para el estudio de la Fe.
        </p>
    </footer>

    <!-- Scripts de Firebase y L√≥gica de la API -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        
        // =========================================================
        // >>> CONFIGURACI√ìN SENCILLA PARA WEBS EXTERNAS <<<
        // 1. **MANDATORIO:** Tu clave de API de Gemini ya est√° insertada.
        // 2. **OPCIONAL:** Si usas Firebase (Firestore) para guardar datos, inserta tu config. Si no, d√©jalo en null.
        // =========================================================

        const GEMINI_API_KEY = "AIzaSyAXBkM6gZ4cbj-0ub6gUWB7VJOPY-ieZQ4"; // CLAVE DE API INSERTADA
        const firebaseConfig = null; 

        // --- Variables de Entorno (Fallback para el ambiente Canvas) ---
        // Usamos variables globales si est√°n definidas (como en Canvas), o usamos la configuraci√≥n local.
        const configToUse = firebaseConfig || (typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null);
        const apiKeyToUse = (typeof __initial_auth_token === 'undefined' ? GEMINI_API_KEY : ''); // Si estamos en Canvas, la clave se inyecta autom√°ticamente.

        // API Configuration
        const MODEL_NAME = 'gemini-2.5-flash-preview-09-2025';
        // Usamos la clave inyectada por el entorno si existe, o la clave definida localmente.
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${MODEL_NAME}:generateContent?key=${apiKeyToUse}`;
        const MAX_RETRIES = 5;

        // Inicializaci√≥n M√çNIMA de Firebase (Para ambientes que la requieren)
        if (configToUse) {
            const app = initializeApp(configToUse);
            const auth = getAuth(app);
            // Solo para evitar errores, iniciamos sesi√≥n an√≥nimamente si se usa Firebase.
            signInAnonymously(auth).catch(error => console.error("Firebase Auth failed:", error));
        }

        // Helper function for exponential backoff
        const fetchWithRetry = async (url, options, retries = 0) => {
            try {
                const response = await fetch(url, options);
                if (!response.ok) {
                    // Si el error es 429 (Too Many Requests), intentamos reintentar.
                    if (response.status === 429 && retries < MAX_RETRIES) {
                        const delay = Math.pow(2, retries) * 1000;
                        console.warn(`Fetch failed (Status ${response.status}). Retrying in ${delay / 1000}s...`);
                        await new Promise(resolve => setTimeout(resolve, delay));
                        return fetchWithRetry(url, options, retries + 1);
                    }
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response;
            } catch (error) {
                if (retries < MAX_RETRIES) {
                    const delay = Math.pow(2, retries) * 1000;
                    console.warn(`Fetch failed. Retrying in ${delay / 1000}s...`);
                    await new Promise(resolve => setTimeout(resolve, delay));
                    return fetchWithRetry(url, options, retries + 1);
                }
                throw error;
            }
        };

        // --- Gemini API Logic ---
        document.getElementById('generar-btn').addEventListener('click', async () => {
            const pacto = document.getElementById('pacto-select').value;
            const pregunta = document.getElementById('pregunta-input').value.trim();
            const resultadoDiv = document.getElementById('resultado-div');
            const aplicacionText = document.getElementById('aplicacion-text');
            const button = document.getElementById('generar-btn');
            const buttonText = document.getElementById('button-text');
            const loader = document.getElementById('loader');

            if (pregunta.length < 5) {
                aplicacionText.textContent = "¬°Escribe una pregunta m√°s espec√≠fica!";
                resultadoDiv.classList.remove('hidden');
                return;
            }

            // UI Feedback: Loading
            buttonText.textContent = 'Generando...';
            button.disabled = true;
            loader.classList.remove('hidden');
            resultadoDiv.classList.add('hidden');
            aplicacionText.textContent = '';


            // System Instruction to guide the LLM's role and tone
            const systemPrompt = `Act√∫a como un mentor cristiano para j√≥venes de 17-21 a√±os. Tu tarea es tomar un Pacto B√≠blico y una pregunta de la vida real, y ofrecer un consejo de aplicaci√≥n extremadamente pr√°ctico, motivador y breve (m√°ximo 3 frases concisas). Aseg√∫rate de que el consejo est√© teol√≥gicamente alineado con el Pacto seleccionado. Usa un tono moderno, amigable, y sin sermones.`;

            const userQuery = `Pacto: ${pacto}. Pregunta de la vida real: ${pregunta}`;

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: {
                    parts: [{ text: systemPrompt }]
                },
            };

            try {
                // Si la clave no est√° definida (y no estamos en Canvas), mostramos error.
                if (!apiKeyToUse && typeof __initial_auth_token === 'undefined') {
                     aplicacionText.textContent = 'ERROR: No se ha encontrado la clave de API. Por favor, aseg√∫rate de que est√© configurada.';
                     resultadoDiv.classList.remove('hidden');
                     return;
                }
                
                const response = await fetchWithRetry(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                const result = await response.json();
                const text = result.candidates?.[0]?.content?.parts?.[0]?.text;

                if (text) {
                    aplicacionText.textContent = text;
                } else {
                    aplicacionText.textContent = 'No pude generar la respuesta. Intenta con otra pregunta.';
                }

                resultadoDiv.classList.remove('hidden');

            } catch (error) {
                console.error("Error al llamar a la API de Gemini:", error);
                aplicacionText.textContent = '¬°Ups! Hubo un error al conectar con el servidor. Int√©ntalo de nuevo.';
                resultadoDiv.classList.remove('hidden');
            } finally {
                // UI Feedback: Done
                buttonText.textContent = 'Generar Consejo ‚ú®';
                button.disabled = false;
                loader.classList.add('hidden');
            }
        });
    </script>

</body>
</html>
